<form [formGroup]="productForm" (ngSubmit)="onSubmit()">
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Tên sản phẩm</mat-label>
    <input matInput formControlName="productName" />
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Giá</mat-label>
    <input matInput type="number" formControlName="price" />
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Trạng thái</mat-label>
    <input matInput formControlName="status" />
  </mat-form-field>

  <!-- Parent Category -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Danh mục cha</mat-label>
    <mat-select formControlName="parentCategoryId" (selectionChange)="onParentCategoryChange($event.value)">
      <mat-option *ngFor="let parent of parentCategories" [value]="parent.id">
        {{ parent.categoryName }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <!-- Child Categories -->
  <mat-form-field appearance="fill" class="full-width" *ngIf="childCategories.length > 0">
    <mat-label>Danh mục con</mat-label>
    <mat-select formControlName="childCategoryIds" multiple>
      <mat-option *ngFor="let child of childCategories" [value]="child.id">
        {{ child.categoryName }}
      </mat-option>
    </mat-select>
  </mat-form-field>


  <div>
    <label>Ảnh chính:</label>
    <input type="file" (change)="onFileSelected($event, 'imgMain')" />
    <div *ngIf="imgMainPreview">
      <img [src]="imgMainPreview" width="100" />
    </div>
  </div>

  <div formArrayName="variants">
    <div *ngFor="let variant of variants.controls; let i = index" [formGroupName]="i" class="variant-section">
      <h4>Màu {{ i + 1 }}</h4>
      <mat-form-field>
        <mat-label>Màu</mat-label>
        <input matInput formControlName="color" />
      </mat-form-field>

      <div>
        <label>Ảnh màu:</label>
        <input type="file" (change)="onFileSelected($event, 'variant', i)" />
        <img *ngIf="imgPreviews[i]" [src]="imgPreviews[i]" width="100" />
      </div>

      <div formArrayName="sizes">
        <div *ngFor="let size of getSizes(i).controls; let j = index" [formGroupName]="j">
          <mat-form-field>
            <mat-label>Size</mat-label>
            <input matInput formControlName="size" />
          </mat-form-field>

          <mat-form-field>
            <mat-label>Tồn kho</mat-label>
            <input matInput type="number" formControlName="stock" />
          </mat-form-field>

          <button mat-button color="warn" (click)="removeSize(i, j)" type="button">Xoá size</button>
        </div>
        <button mat-button color="primary" (click)="addSize(i)" type="button">Thêm size</button>
      </div>

      <button mat-button color="warn" (click)="removeStock(i)" type="button">Xoá màu</button>
    </div>
  </div>

  <button mat-button color="primary" (click)="addStock()" type="button">Thêm màu</button>
  <br /><br />
  <button mat-raised-button color="primary" type="submit">Cập nhật</button>
  <button mat-button (click)="onCancel()" type="button">Huỷ</button>
</form>
